@inherits Umbraco.Web.Mvc.UmbracoTemplatePage
@using Casament.Models
@using Umbraco.Core.Logging;

@{
    Layout = "Base.cshtml";
}
@{
    @Html.Partial("SignInForm", new SignInModel())


    if (User.Identity.IsAuthenticated)
    {
        var currentMember = Membership.GetUser() != null ? Membership.GetUser().UserName : null;
        var member = ApplicationContext.Current.Services.MemberService.GetByUsername(currentMember);
        if (member.GetValue<bool>("invitation") || (member.GetValue<bool>("notFirstTime") && Request.Browser.IsMobileDevice))
        {
            @Html.Partial("SideBar")
            @Umbraco.RenderMacro("HomeRender")
        }
        else
        {
            Response.Redirect("/invitacio");
        }
    }
}
